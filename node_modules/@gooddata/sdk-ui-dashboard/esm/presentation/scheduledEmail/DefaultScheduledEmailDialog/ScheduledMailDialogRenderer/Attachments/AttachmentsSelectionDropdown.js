// (C) 2022 GoodData Corporation
import { __assign, __read } from "tslib";
import * as React from "react";
import { useCallback, useState } from "react";
import { injectIntl, FormattedMessage } from "react-intl";
import identity from "lodash/identity";
import { Icon, Typography } from "@gooddata/sdk-ui-kit";
import { withTheme } from "@gooddata/sdk-ui-theme-provider";
import { ScheduleDropdown } from "./ScheduleDropdown";
import { objRefToString } from "@gooddata/sdk-model";
var ICON_SIZE_BUTTON = 18;
var ICON_SIZE = 24;
var AttachmentsSelectionDropdownComponent = function (props) {
    var _a, _b, _c, _d;
    var intl = props.intl, theme = props.theme, dashboardTitle = props.dashboardTitle, _e = props.insightWidgets, insightWidgets = _e === void 0 ? [] : _e, onApply = props.onApply;
    var _f = __read(useState(props.dashboardSelected), 2), dashboardSelected = _f[0], setDashboardSelected = _f[1];
    var _g = __read(useState(props.widgetsSelected), 2), widgetsSelected = _g[0], setWidgetsSelected = _g[1];
    var handleWidgetSelectedChange = useCallback(function (widgetRef) {
        var _a;
        var widgetRefKey = objRefToString(widgetRef);
        setWidgetsSelected(__assign(__assign({}, widgetsSelected), (_a = {}, _a[widgetRefKey] = !widgetsSelected[widgetRefKey], _a)));
    }, [widgetsSelected]);
    var handleOnApply = useCallback(function () {
        onApply(dashboardSelected, widgetsSelected);
    }, [onApply, dashboardSelected, widgetsSelected]);
    var handleOnCancel = useCallback(function () {
        setDashboardSelected(props.dashboardSelected);
        setWidgetsSelected(props.widgetsSelected);
    }, [props.dashboardSelected, props.widgetsSelected]);
    var canApply = (dashboardSelected || Object.values(widgetsSelected).some(identity)) &&
        (dashboardSelected != props.dashboardSelected ||
            JSON.stringify(widgetsSelected) !== JSON.stringify(props.widgetsSelected));
    return (React.createElement(ScheduleDropdown, { title: intl.formatMessage({ id: "dialogs.schedule.email.attachment.select" }), applyDisabled: !canApply, onApply: handleOnApply, onCancel: handleOnCancel, buttonClassName: "s-schedule-select-attachments-button", bodyClassName: "s-schedule-select-attachments-body", iconComponent: React.createElement(Icon.AttachmentClip, { color: (_b = (_a = theme === null || theme === void 0 ? void 0 : theme.palette) === null || _a === void 0 ? void 0 : _a.complementary) === null || _b === void 0 ? void 0 : _b.c6, width: ICON_SIZE_BUTTON, height: ICON_SIZE_BUTTON }), contentComponent: React.createElement("div", { className: "gd-attachments-selection-dropdown" },
            React.createElement(Typography, { tagName: "h3" },
                React.createElement(FormattedMessage, { id: "dialogs.schedule.email.attachment.select.dashboard.header" })),
            React.createElement("div", null,
                React.createElement("label", { className: "input-checkbox-label s-schedule-dashboard-attachment-label" },
                    React.createElement("input", { type: "checkbox", className: "input-checkbox", checked: dashboardSelected, onChange: function (event) { return setDashboardSelected(event.target.checked); } }),
                    React.createElement(Icon.Dashboard, { color: (_d = (_c = theme === null || theme === void 0 ? void 0 : theme.palette) === null || _c === void 0 ? void 0 : _c.complementary) === null || _d === void 0 ? void 0 : _d.c6, width: ICON_SIZE, height: ICON_SIZE }),
                    React.createElement("span", { title: dashboardTitle, className: "input-label-text" }, dashboardTitle))),
            React.createElement(Typography, { tagName: "h3" },
                React.createElement(FormattedMessage, { id: "dialogs.schedule.email.attachment.select.widgets.header" })),
            insightWidgets.map(function (widget) {
                var _a, _b;
                return (React.createElement("div", { key: objRefToString(widget) },
                    React.createElement("label", { className: "input-checkbox-label s-schedule-widget-attachment-label" },
                        React.createElement("input", { type: "checkbox", className: "input-checkbox", checked: widgetsSelected[objRefToString(widget)], onChange: function () { return handleWidgetSelectedChange(widget); } }),
                        React.createElement(Icon.Chart, { color: (_b = (_a = theme === null || theme === void 0 ? void 0 : theme.palette) === null || _a === void 0 ? void 0 : _a.complementary) === null || _b === void 0 ? void 0 : _b.c6, width: ICON_SIZE, height: ICON_SIZE }),
                        React.createElement("span", { title: widget.title, className: "input-label-text" }, widget.title))));
            })) }));
};
export var AttachmentsSelectionDropdown = injectIntl(withTheme(AttachmentsSelectionDropdownComponent));
//# sourceMappingURL=AttachmentsSelectionDropdown.js.map